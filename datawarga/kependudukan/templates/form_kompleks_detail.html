{% extends "base.html" %}
{% block title %}Data Rumah{% endblock %}
{% block pagetitle %}Data Rumah Blok {{ data.blok }} / Nomor {{ data.nomor }} {% endblock %}
{% block content %}
{% load crispy_forms_tags %}
<div class="row">
    <div class="col-lg-4 border-bottom">
        <h5>Edit Data Rumah</h5>
        <form method="post" enctype="multipart/form-data" id="warga-form" action="{% url 'kependudukan:detailKompleks' data.id %}">
            {% csrf_token %}
            <div class="mb-3">
                <label for="alamat" class="form-label">Alamat</label>
                <input type="text" class="form-control" id="alamat" name="alamat" maxlength="255" value="{{ data.alamat }}">
            </div>
            <div class="mb-3">
                <label for="kelurahan" class="form-label">Kelurahan</label>
                <input type="text" class="form-control" id="kelurahan" name="kelurahan" maxlength="150" value="{{ data.kelurahan }}">
            </div>
            <div class="mb-3">
                <label for="kecamatan" class="form-label">Kecamatan</label>
                <input type="text" class="form-control" id="kecamatan" name="kecamatan" maxlength="150" value="{{ data.kecamatan }}">
            </div>
            <div class="mb-3">
                <label for="kota" class="form-label">Kota</label>
                <input type="text" class="form-control" id="kota" name="kota" maxlength="150" value="{{ data.kota }}">
            </div>
            <div class="mb-3">
                <label for="provinsi" class="form-label">Provinsi</label>
                <input type="text" class="form-control" id="provinsi" name="provinsi" maxlength="150" value="{{ data.provinsi }}">
            </div>
            <div class="mb-3">
                <label for="kode_pos" class="form-label">Kode Pos</label>
                <input type="text" class="form-control" id="kode_pos" name="kode_pos" maxlength="150" value="{{ data.kode_pos }}">
            </div>
            <div class="mb-3">
                <label for="cluster" class="form-label">Nama Cluster</label>
                <input type="text" class="form-control" id="cluster" name="cluster" maxlength="150" value="{{ data.cluster }}">
            </div>
            <div class="mb-3">
                <label for="blok" class="form-label">Blok</label>
                <input type="text" class="form-control" id="blok" name="blok" aria-describedby="blokHelp" maxlength="10" required value="{{ data.blok }}">
                <div id="blokHelp" class="form-text">Nama Blok saja.</div>
            </div>
            <div class="mb-3">
                <label for="rt" class="form-label">RT</label>
                <input type="text" class="form-control" id="rt" name="rt" maxlength="4" required value="{{ data.rt }}">
            </div>
            <div class="mb-3">
                <label for="rw" class="form-label">RW</label>
                <input type="text" class="form-control" id="rw" name="rw" maxlength="4" required value="{{ data.rw }}">
            </div>
            <div class="mb-3">
                <label for="nomor" class="form-label">Nomor</label>
                <input type="number" class="form-control" id="nomor" name="nomor" maxlength="3" required value="{{ data.nomor }}">
            </div>
            <div class="mb-3">
                <label for="description" class="form-label">Catatan</label>
                <input type="description" class="form-control" id="description" name="description" maxlength="200" value="{% if data.description == None %}{% else %}{{ data.description }}{% endif %}">
            </div>
            
            <button type="submit" class="btn btn-primary"><i class="bi bi-database-check"></i> Simpan Data Rumah</button>

        </form>
    </div>
    <div class="col-lg-8 border-bottom">
        <div class="py-2">
            <h5>Data Warga Penghuni</h5>
            <p>Berikut ini adalah daftar warga penghuni blok {{ data.blok }} / No. {{ data.nomor }}</p>
            <p><a href="{% url 'kependudukan:formWargaRumah' data.id %}" class="btn btn-primary btn-sm"><i class="bi bi-plus"></i></a></p>
            <div id="tabelwarga"></div>
        </div>
    </div>
</div>

{% if message %}
<div class="alert alert-info alert-dismissible fade show" role="alert">
    {{ message | safe}}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endif %}
{% endblock %}

{% block jscript %}
<script>
    $.getJSON("{{ load_url }}", function(response) {
        console.log(response);
        var data = response.data;
        var count = response.total;

        
        if (count === 0) {
            $("#tabelwarga").append("No Data");
        }else{
            var table = "<table class=\"table table-striped\">";
            table += "<tr><th>NIK</th><th>Nama Lengkap</th><th>HP</th></tr>";
            $.each(data, function(key, value) {
                table += "<tr><td>" + value.fields.nik + "</td><td><a href=\"/warga/form-warga/" + value.pk + "\">" + value.fields.nama_lengkap + "</td><td>" + value.fields.no_hp + "</td></tr></a>";
            });
            table += "</table>";
            $("#tabelwarga").append(table);
        }
    });
</script>
{% endblock %}